# Currency_trading_service

Сервис предназначен для получения информации о текущих курсах валют, предсказания курсов для заключения сделок купли-продажи валюты и анализа финансового результата сделок.

![](https://github.com/gribkov-s/Currency_trading_service/blob/master/images/schema.jpeg)

1.	Producer – приложение Spark – с заданной периодичностью отправляет http запрос API для получения курса рубля к другим валютам, полученные данные записывает в очередь Kafka

2.	Consumer – приложение Spark Streaming – с заданной периодичностью читает данные из очереди Kafka, проводит преобразования данных и записывает подготовленные данные 
в таблицу БД PostgreSQL. Преобразования заключаются в следующем:
•	Выбор валют, с которыми будут заключаться сделки (по наличию в справочнике в БД)
•	Пересчет стоимости 1 рубля в валюте на стоимость единицы валюты в рублях
•	Пересчет курса каждой валюты в соответствии с принятой для заключения сделок шкалой (например, 100 индийских рупий, 1 евро и т.д.). Шкалы валют хранятся в справочнике в БД.

3.	Данные о  почасовых курсах валют, находящиеся в витрине данных в БД, использует модель машинного обучения  - приложение Spark ML - для предсказания курсов на следующий час. 
В модели используется «дерево решений». Модель получает данные для обучения из витрины в БД, вычисляет прогнозные значения и записывает их в таблицу БД.

4.	Для анализа данных и заключения сделок в БД создана витрина данных, моделирование сделок и расчета финансового результата осуществляется следующим образом – 
•	Новая сделка заключается по каждой валюте каждый час на одну и ту же сумму – 1 млн единиц валюты с учетом шкалы
•	На основании прогноза принимается решение – если прогнозируется рост курса в следующем часе то осуществляется покупка для последующей продажи, если снижение то осуществляется продажа для последующей покупки. Рассчитывается прогнозный финансовый результат.
•	В следующем часе рассчитывается фактический финансовый результат – как  разница между суммой сделки по курсу предыдущего часа и суммой, пересчитанной на курс текущего часа.
•	В качестве значений курсов за предыдущий час и прогнозного курса используются значения, полученные последними в предыдущем часе.

5.	Для визуализации данных для анализа используется bi платформа Metabase
